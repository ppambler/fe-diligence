### âœï¸ Tangxt â³ 2022-01-09 ğŸ·ï¸ Node.js

# 06-å‘½ä»¤è¡Œç¿»è¯‘å·¥å…·

ç»“åˆå‘½ä»¤è¡Œå·¥å…·å’Œ http æ¨¡å—çš„ request æ¨¡å—æ¥åšä¸€ä¸ªç¿»è¯‘å·¥å…·

åœ¨ç»ˆç«¯è¾“å…¥ï¼š`fy world` -> å°±ä¼šè¾“å‡ºï¼š`ä¸–ç•Œ`

### <mark>1ï¼‰ä½¿ç”¨ç™¾åº¦ç¿»è¯‘ API</mark>

> `alt + 1`ã€`alt + 2` -> åˆ‡æ¢åˆ°æ–‡ä»¶ç›®å½•ã€åˆ‡æ¢åˆ°ç»ˆç«¯

1. åˆ›å»º`fanyi`ç›®å½•
2. `cd fanyi`
3. `yarn init -y`
   1. ä¿®æ”¹ç‰ˆæœ¬å·ä¸º`0.0.1`
4. åˆ›å»º`src`ç›®å½• -> ç”¨æ¥æ”¾ç½®æºä»£ç 
   1. `main.ts`
5. æ·»åŠ `scripts` -> `'start'ï¼š 'ts-node-dev src/main.ts'`
6. å®‰è£…`commander` -> æ‰‹å¦è¦æ‰‹åŠ¨å®‰è£…`types`å£°æ˜ï¼Ÿ
   1. ä¸éœ€è¦ï¼Œå®ƒæœ‰ä¸ª`typings`ç›®å½•ï¼Œè¿™é‡Œè¾¹æœ‰ä¸€ä¸ª`index.d.ts`ï¼Œä¹Ÿå°±æ˜¯è¯´å®ƒè‡ªå¸¦äº†`types`å£°æ˜ -> å› æ­¤æˆ‘ä»¬ä¸éœ€è¦å®‰è£…è¿™ä¸ªé¢å¤–å·¥å…·äº†
7. åˆ›å»º`src/cli.ts` -> ä¸“é—¨ç”¨æ¥å¤„ç†å‘½ä»¤è¡Œ
8. ç”±äºåœ¨åš`node`å¼€å‘ -> å®‰è£…`@types/node`æ‰ä¼šæœ‰ä»£ç æç¤º -> è¿™æ˜¯å¼€å‘ä¾èµ–
9. åœ¨`cli.ts`é‡Œè¾¹ä½¿ç”¨`commander`

> [Demo](https://github.com/ppambler/fe-diligence-demo/commit/3dd1627)

ğŸ’¡ï¼šæ›´æ”¹`Usage`çš„è¾“å‡ºæƒ…å†µï¼Ÿ

![Usage](assets/img/2022-01-11-18-21-13.png)

``` js
// import * as commander from "commander";
// const program = new commander.Command();
import { Command } from "commander";
const program = new Command();
program.version("0.0.1").name("fy").usage("<english>");

// è§£æå‚æ•°ï¼Œæ¯”å¦‚è‡ªå¸¦çš„ -hï¼Œå’Œæˆ‘ä»¬é€šè¿‡ program.version å†™çš„ -V
// æ ¹æ®è§£æç»“æœï¼Œä¼šåœ¨ç»ˆç«¯æ‰“å°ç›¸åº”çš„å†…å®¹
program.parse(process.argv);

```

![fy](assets/img/2022-01-11-18-23-27.png)

ğŸ‘‡ï¼šæ·»åŠ åŠŸèƒ½ -> è·å–è¾“å…¥çš„å•è¯ï¼Œç„¶ååˆ°ç½‘ä¸ŠæŸ¥è¯¢è¿™ä¸ªå•è¯çš„ç¿»è¯‘ï¼Œå†æ˜¾ç¤ºåˆ°ç»ˆç«¯

ğŸ’¡ï¼šè·å–ç”¨æˆ·è¾“å…¥çš„å•è¯

![hello](assets/img/2022-01-11-18-30-46.png)

---

![hello](assets/img/2022-01-12-18-09-16.png)

> [Demo](https://github.com/ppambler/fe-diligence-demo/commit/c426bc6)

ğŸ’¡ï¼šå¦‚ä½•æŠŠè·å–åˆ°çš„å•è¯è½¬åŒ–æˆä¸­æ–‡ï¼Ÿ

- æ¨èç™¾åº¦å’Œæœ‰é“ç¿»è¯‘æ¥å£
- è°·æ­Œçš„ç¿»è¯‘æ¥å£è¢«å¢™äº†

ç”³è¯·å¥½åï¼Œä¸è¦æš´éœ²ä½ çš„ APP ID å’Œå¯†é’¥ï¼š

![æ¥å£ç”³è¯·](assets/img/2022-01-12-17-33-55.png)

æ–‡æ¡£ï¼š[ç™¾åº¦ç¿»è¯‘å¼€æ”¾å¹³å°](https://fanyi-api.baidu.com/doc/21)

ç”¨`HTTPS`çš„

ä¸€ä¸ªè¯·æ±‚ç¤ºä¾‹ï¼š

<https://api.fanyi.baidu.com/api/trans/vip/translate?q=apple&from=en&to=zh&appid=2015063000000001&salt=1435660288&sign=f89f9594663708c1605f3d736d01d2d4>

![ç¤ºä¾‹](assets/img/2022-01-12-17-37-37.png)

æˆ‘ä»¬è¦å…³æ³¨çš„è¾“å…¥ï¼š

![è¾“å…¥](assets/img/2022-01-12-17-42-31.png)

æ³¨æ„ï¼Œå¦‚æœä½ çš„è¯·æ±‚é“¾æ¥è¢«æ³„æ¼äº†ï¼Œè¿™ä¹Ÿä¸æ‰“ç´§ï¼Œå› ä¸ºè¿™ä¸ªé“¾æ¥åªèƒ½å›ºå®šè¯·æ±‚è¿™ä¸ªå•è¯

æ¯”å¦‚è¿™æ ·ï¼š

![ç¤ºä¾‹](assets/img/2022-01-12-17-45-54.png)

ğŸ’¡ï¼šä¸å¯çŸ¥éªŒè¯

![éªŒè¯](assets/img/2022-01-12-17-56-23.png)

â¹ï¼š[å¼€æ”¾ api æ¥å£ç­¾åéªŒè¯ï¼Œä¿è¯é€šè®¯çš„å®‰å…¨æ€§ - çŸ¥ä¹](https://zhuanlan.zhihu.com/p/448418213)

---

çŸ¥é“è¯·æ±‚åœ°å€æ˜¯ä»€ä¹ˆï¼Œä»¥åŠéœ€è¦ä»€ä¹ˆå‚æ•°åï¼Œæˆ‘ä»¬å°±å¾—ç”¨ Node.js å»å‘è¯·æ±‚äº†ï¼Œä¹‹å‰æˆ‘ä»¬æ¥è§¦çš„ Node.js å“åº”ï¼Œç°åœ¨åˆ™æ˜¯è¯·æ±‚

### <mark>2ï¼‰ä½¿ç”¨ Node.js è°ƒç”¨ç™¾åº¦ API</mark>

æ–‡æ¡£ï¼š[https å®‰å…¨è¶…æ–‡æœ¬ä¼ è¾“åè®® - Node.js API æ–‡æ¡£](http://nodejs.cn/api/https.html#httpsrequesturl-options-callback)

ğŸ’¡ï¼šæ‹¿åˆ°ç™¾åº¦é¦–é¡µçš„æ•°æ®

![æ•°æ®](assets/img/2022-01-12-18-14-47.png)

ğŸ’¡ï¼šæµ‹è¯•ç™¾åº¦ç¿»è¯‘é»˜è®¤ç»™å‡ºçš„é‚£ä¸ªæ¥å£

![ç¿»è¯‘æ¥å£](assets/img/2022-01-12-19-21-26.png)

â¹ï¼š[nodejs ä¸­çš„ process.stdout.write](https://blog.csdn.net/weixin_43487782/article/details/117488160)

â¹ï¼š[javascript - Difference between "process.stdout.write" and "console.log" in node.js? - Stack Overflow](https://stackoverflow.com/questions/4976466/difference-between-process-stdout-write-and-console-log-in-node-js)

ğŸ’¡ï¼šæ”¹æˆè‡ªå·±æƒ³è¦çš„è¯·æ±‚åœ°å€ï¼Œä¹Ÿå°±æ˜¯ç¿»è¯‘ API æ¥å£

æ–‡æ¡£ï¼š[querystring æŸ¥è¯¢å­—ç¬¦ä¸² - Node.js API æ–‡æ¡£](http://nodejs.cn/api/querystring.html#querystringstringifyobj-sep-eq-options)

![æŸ¥è¯¢å­—ç¬¦ä¸²](assets/img/2022-01-12-18-17-59.png)

æµ‹è¯•`querystring`ï¼š

![querystring](assets/img/2022-01-12-18-23-44.png)

> ä¸éœ€è¦æˆ‘ä»¬éœ€è¦ `https` è¿™æ ·çš„åè®®

ğŸ’¡ï¼šNode.js æ²¡æœ‰è‡ªå¸¦çš„`md5`ï¼Œæˆ‘ä»¬éœ€è¦è‡ªå·±å®‰è£…

![md5](assets/img/2022-01-12-18-28-24.png)

å®ƒä¸æ”¯æŒ TSï¼Œä¹Ÿå°±æ˜¯æ²¡æœ‰é‚£ä¸ª`@types`

æˆ‘ä»¬ç»å¸¸ä¼šçœ‹åˆ°æœ‰äº›åº“è¯´åˆ°ã€Œè¯¥åº“å®Œç¾å…¼å®¹ TSã€ï¼Œæˆ‘ä»¬çŸ¥é“ TS æœ¬æ¥å°±å…¼å®¹ JS çš„ï¼Œå¯åŠ ã€Œå®Œç¾ã€äºŒå­—æ˜¯ä¸ºå•¥å‘¢ï¼Ÿ

æ¯”å¦‚`md5`å°±æ²¡æœ‰å®Œç¾å…¼å®¹ï¼Œä½ çœ‹çœ‹`commander`ï¼Œå®ƒå°±æ˜¯å®Œç¾å…¼å®¹çš„ï¼Œä½ å†™å•¥ API éƒ½ä¼šç”¨ä»£ç æç¤º

å½“ç„¶ï¼Œå‰ç«¯ç¤¾åŒºä¹Ÿæä¾›äº†æœ‰å…³`md5`çš„`types`å£°æ˜

``` bash
yarn add @types/md5 -D
```

![md5](assets/img/2022-01-12-18-32-53.png)

ä½¿ç”¨`md5`ï¼š

![md5](assets/img/2022-01-12-18-36-21.png)

> å¾—åˆ°æ˜¯ä¸€ä¸ª 32 ä½çš„å­—ç¬¦ä¸²

ğŸ’¡ï¼šå¯†é’¥å’Œ ID ä¸èƒ½è¢«æ³„æ¼

![ID](assets/img/2022-01-12-20-30-57.png)

### <mark>4ï¼‰å¤„ç† Secret & ä½¿ç”¨ TypeScript å£°æ˜ BaiduResult</mark>

ä¸ºäº†ä¸æ³„æ¼å¯†é’¥å’Œ IDï¼Œæˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ª`private.ts`æ–‡ä»¶ -> åœ¨è¿™ä¸ªæ–‡ä»¶é‡Œè¾¹å†™è¿™ä¸¤ä¸ªæ•°æ®

ğŸ’¡ï¼šç”¨è‡ªå·±çš„å¯†é’¥å’Œ APP ID å»æµ‹è¯•å…¶å®ƒå•å­—çš„ç¿»è¯‘

![ç¿»è¯‘](assets/img/2022-01-12-20-41-00.png)

ğŸ’¡ï¼šå¦‚ä½•è·å–`response`çš„æ¶ˆæ¯ä½“ï¼Ÿ

![è·å–æ¶ˆæ¯ä½“](assets/img/2022-01-12-22-34-32.png)

ğŸ’¡ï¼šå¦‚ä½•çŸ¥é“å¯¹è±¡æœ‰ä»€ä¹ˆï¼Ÿ

æ ¹æ®å“åº”ç»“æœæ¥å†™`type`

![type](assets/img/2022-01-12-22-42-56.png)

![type](assets/img/2022-01-12-22-47-22.png)

ğŸ’¡ï¼š`trans_result` -> è¿™ä¸ª`trans`ä¸è¦ç¼©å†™

å› ä¸º`trans`æœ‰å¥³è£…å¤§ä½¬ä¹‹æ„ï¼Œä¹Ÿå°±æ˜¯ã€Œè·¨æ€§åˆ«ã€

ä¸çŸ¥é“è¿™ä¸ªè‹±æ–‡çš„ç®€å†™æ˜¯ä½•æ„å°±ä¸è¦ç”¨ç¼©å†™ï¼Œæ¯”å¦‚ä½ å†™ TypeScript çš„ç¼©å†™`ts`ï¼Œä¹Ÿæœ‰å¥³è£…å¤§ä½¬çš„æ„æ€

ğŸ’¡ï¼šé”™è¯¯ç å¤„ç†

ä¸ºä»€ä¹ˆéœ€è¦å¤„ç†ï¼Ÿ

![é”™è¯¯ç ](assets/img/2022-01-12-22-54-24.png)

é”™è¯¯ç ä¸­æ–‡åŒ–å¤„ç†ï¼ˆæœ¬æ¥è¿”å›è‹±æ–‡çš„ï¼‰ï¼š

![é”™è¯¯å—](assets/img/2022-01-12-23-04-52.png)

### <mark>5ï¼‰è¡¨é©±åŠ¨ç¼–ç¨‹æ¶ˆé™¤å¤šä½™çš„ if</mark>

å½“ä½ çš„é¡¹ç›®ä»£ç è¶Šæ¥è¶Šå¤šï¼Œä½ ä¼šçœ‹åˆ°è¿™æ ·çš„å¼±æ™ºä»£ç ï¼š

![if else](assets/img/2022-01-12-23-10-40.png)

å¦‚ä½•æ¶ˆé™¤è¿™æ ·çš„å¼±æ™ºä»£ç ï¼Ÿ

> åªè¦`if else` è¶…è¿‡ 5 ä¸ªï¼Œé‚£ä¹ˆä½ çš„ä»£ç å°±ä¸€å®šæœ‰é—®é¢˜

> [Demo](https://github.com/ppambler/fe-diligence-demo/commit/af093d6)

ç±»ä¼¼ä¸€æœºä¸€ç è¿™æ ·

è¿˜æœ‰æ›´å¤æ‚çš„æƒ…å†µï¼Œæ¯”å¦‚`{}`é‡Œè¾¹æœ‰å¤šä¸ªå˜é‡èµ‹å€¼çš„æƒ…å†µï¼Œä¹Ÿå¯ä»¥ç”¨è¡¨é©±åŠ¨ç¼–ç¨‹

### <mark>6ï¼‰è‹±è¯‘ä¸­ & ä¸­è¯‘è‹±</mark>

![ç¿»è¯‘](assets/img/2022-01-12-23-55-19.png)

> [Demo](https://github.com/ppambler/fe-diligence-demo/commit/18b04f4)

ğŸ’¡ï¼š`cli.ts` è¿™æ˜¯ ts æ–‡ä»¶ï¼Œæˆ‘ä»¬éœ€è¦æŠŠå®ƒç¼–è¯‘æˆ js æ–‡ä»¶ï¼Œæ‰èƒ½äº¤ç»™ node å»æ‰§è¡Œ

### <mark>7ï¼‰å¦‚ä½•å‘å¸ƒ TypeScript åŒ…åˆ° npm</mark>

å…¨å±€å®‰è£…`typescript`

æŸ¥çœ‹`tsc`ç‰ˆæœ¬

``` bash
tsc -V
# Version 4.5.4
```

åˆ›å»º`tsconfig`æ–‡ä»¶

![tsc](assets/img/2022-01-13-00-02-50.png)

æœ‰äº†è¿™ä¸ªæ–‡ä»¶ä¹‹åï¼Œä½ ä¼šå‘ç°åŸå…ˆçš„`main.ts`æ–‡ä»¶çˆ†çº¢äº†

![çˆ†çº¢](assets/img/2022-01-13-00-04-29.png)

ç¡®å®šè¿™ä¸ªå€¼çš„ç±»å‹ -> ç”¨`constructor`å°±å¥½äº†

---

`tsconfig.json`è¿™ä¸ªæ–‡ä»¶å¾ˆå¤§ï¼Œæˆ‘ä»¬è¦æ”¹çš„åœ°æ–¹ä¸å¤š

![é…ç½®](assets/img/2022-01-13-00-19-30.png)

å°±æ”¹è¿™ä¸ªï¼š`"outDir": "dist/"`

ğŸ’¡ï¼š`@types/node`å’Œ`node`ä¸æ˜¯å®Œå…¨å…¼å®¹çš„

![å…¼å®¹æƒ…å†µ](assets/img/2022-01-13-00-12-29.png)

æ¶ˆé™¤ ts æŠ¥é”™ï¼š

> [Demo](https://github.com/ppambler/fe-diligence-demo/commit/1f636eb)

ğŸ’¡ï¼šç¼–è¯‘æ–‡ä»¶

ç›´æ¥åœ¨é¡¹ç›®æ ¹ç›®å½•æ•²`tsc`å³å¯ï¼š

![tsc](assets/img/2022-01-13-00-25-01.png)

è¯¥`dist`ç›®å½•ä¸èƒ½ä¸Šä¼ ï¼Œå› ä¸ºæœ‰å¯†é’¥

ğŸ’¡ï¼šå‘å¸ƒå‰çš„é…ç½®

> [Demo](https://github.com/ppambler/fe-diligence-demo/commit/739e6cf)

ğŸ’¡ï¼šæœ¬åœ°æµ‹è¯•æƒ…å†µ

``` bash
yarn link
```

![æµ‹è¯•æƒ…å†µ](assets/img/2022-01-13-00-42-01.png)

ä¹Ÿå¯ä»¥é…ç½®åˆ«åï¼ˆæ³¨æ„è·¯å¾„ï¼‰ï¼š

![åˆ«å](assets/img/2022-01-13-00-51-33.png)

ğŸ’¡ï¼šå¯¹æ¯”å…¶å®ƒçš„ï¼Œæ¯”å¦‚`fanyi`

``` bash
npm install fanyi -g
```

![fanyi](assets/img/2022-01-13-00-49-58.png)

â¹ï¼š[afc163/fanyi: A ğŸ‡¨ğŸ‡³ and ğŸ‡ºğŸ‡¸ translate tool in your command line.](https://github.com/afc163/fanyi)

â¹ï¼š[åŸºäºç™¾åº¦ç¿»è¯‘ API çš„ node æ’ä»¶ - æ˜é‡‘](https://juejin.cn/post/6906787897811501063)

---

æ³¨æ„ï¼šä¸è¦è¯´`md5`åŠ å¯†ï¼Œä¸€æ—¦ä½ è¿™ä¹ˆè¯´äº†ï¼Œé‚£ä¹ˆä½ å°±æ˜¯å¤–è¡Œäº†ï¼

### <mark>8ï¼‰æ€»ç»“å’Œé—®ç­”</mark>

> å¦‚æœæƒ³æŠŠè¿™ä¸ªé¡¹ç›®ä½œä¸ºé¢è¯•é¡¹ç›®ï¼Œé‚£ä¹ˆä½ å¯ä»¥æŠŠå¯†é’¥å‘å¸ƒï¼Œé¢è¯•å®Œï¼Œå†æŠŠä½ è´¦å·çš„ä½ å¯†é’¥ç»™é‡ç½®äº†

ç”¨åˆ°äº†ä¸‰ä¸ªæ¨¡å—ï¼š

``` js
import * as https from "https";
import * as querystring from "querystring";
import md5 = require("md5");
```

- `querystring.stringify()`ï¼šæ„å»ºæŸ¥è¯¢å­—ç¬¦ä¸²
- `https.request`ï¼šå‘è¯·æ±‚
- TS å£°æ˜ -> å…³äºå¯¹è±¡çš„å£°æ˜
- åŠŸèƒ½ï¼šç”¨åˆ°äº†ç™¾åº¦æ”¶è´¹çš„ API -> å¯ä»¥ä¸­è¯‘è‹±ï¼Œä¹Ÿå¯ä»¥è‹±è¯‘ä¸­

![é¢˜ç›®](assets/img/2022-01-13-01-19-01.png)

ğŸ’¡ï¼šå‰æœçš„å‰‘æ–©æœ¬æœçš„å®˜ï¼Ÿ

ä¿—è¯­ã€‚æŒ‡ç”¨å‰æœä»£çš„æ³•å¾‹ï¼Œå»å¤„ç†ç°åœ¨è¿™ä¸ªæœä»£çš„å®˜å‘˜ã€‚ç°ä»£å»¶ä¼¸æŒ‡ä¸åŒæ—¶ä»£çš„æ³•å¾‹æœ‰æ‰€å·®å¼‚ï¼Œæ— æ³•ç›´æ¥é€‚ç”¨

ğŸ’¡ï¼š`import` å’Œ `require` æ··åˆç”¨

![import](assets/img/2022-01-13-01-08-13.png)

é¦–é€‰ ES Modulesï¼Œæ¬¡é€‰ CommonJS 

ğŸ’¡ï¼štsc é»˜è®¤çš„ç¼–è¯‘ç»“æœéƒ½æ˜¯ CommonJS è§„èŒƒçš„

> ä½ å¯ä»¥åˆ°`tsconfig.json`é‡Œè¾¹é…ç½®`module`é€‰é¡¹

![ç¼–è¯‘ç»“æœ](assets/img/2022-01-13-01-09-43.png)

ä½¿ç”¨äº† TS å»å¼€å‘ Node åº”ç”¨åï¼Œä½ å¯ä»¥ç›´æ¥ç”¨ `import` å’Œ `export` å»å¯¼å…¥å¯¼å‡ºæ¨¡å—ï¼Œæ¯•ç«Ÿä½ å¯ä»¥ç›´æ¥ç”¨`ts-node-dev`å»è¿è¡Œä½ çš„ TS ä»£ç 

Node å¯¹ ES Modules çš„æ”¯æŒ -> `>=9`çš„ Node æ‰æ”¯æŒ

æœç´¢ã€Œnode esmodules å¼€å¯ã€ï¼š

- [2020 å¹´æˆ‘ä»¬å¯ä»¥åœ¨ Node ä¸­ä½¿ç”¨ ES Modules äº†å— - çŸ¥ä¹](https://zhuanlan.zhihu.com/p/337796076)
- [Node 9 ä¸‹ import/export çš„ä¸èˆ¬é¡ºæ»‘ä½¿ç”¨ - CNode æŠ€æœ¯ç¤¾åŒº](https://cnodejs.org/topic/5a0f2da5f9de6bb0542f090b)